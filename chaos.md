# AlphaCTF2k24
## chaos
### Challenge Description

The challenge provides a Python code snippet that generates a pseudo-random number generator (PRNG) output, which is then used to encrypt a flag using the AES encryption algorithm. 

### Given Code Snippet

```python
#!/usr/bin/env python3

from Crypto.Util.number import bytes_to_long
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
from flag import FLAG
from random import getrandbits 

def getRandom(bits, rounds):
    for _ in range(rounds):
        a = getrandbits(bits)
        print(f'{a}')
    a = getrandbits(bits)
    return a.to_bytes(32, 'little')

key = getRandom(256, 100)
iv = b"alpha_gift_for_u"

cipher = AES.new(key, AES.MODE_CBC, iv)
enc = cipher.encrypt(pad(FLAG,AES.block_size))
print(f'enc={bytes_to_long(enc)}')

```

## Solution Approach
### Aes encryption 
AES (Advanced Encryption Standard) is a widely-used encryption algorithm that uses a key (128, 192, or 256 bits) to encrypt and decrypt data. In AES-CBC (Cipher Block Chaining) mode wich is used in this challenge, an Initialization Vector (IV) is used to ensure each encrypted message is unique. The IV helps prevent patterns in the plaintext from being visible in the ciphertext.

## Decrypting AES Encrypted Message in the Challenge

To decrypt a message encrypted with AES (Advanced Encryption Standard), you need to know the key and the Initialization Vector (IV). The challenge provides the IV in the code, so the goal is to determine the key used.

The key is generated using Python's random library. Initially, it generates 99 numbers of 256 bits, and the 100th value is the key used.

After some research, it was found that the random library in Python uses a pseudo-random number generator (PRNG) to generate numbers, which are not truly random. The library takes a seed and uses it to generate numbers.

To find the key, we can use a tool or method to predict the state or seed used by the PRNG. One such tool is randcrack, which can take 624 32-bit numbers to find the state and predict the next numbers.

The challenge is that we only have 99 numbers of 256 bits, but we need 624 32-bit numbers. To address this, we convert each 256-bit number into 8 32-bit numbers using a simple calculation:

```python
v_32 = []
for num in range(len(values)):
    for j in range(256 // 32):
        v_32.append((values[num] >> (j * 32)) & 0xFFFFFFFF)
```

Once we have 800 32-bit numbers from the 99 256-bit numbers, we can feed them to randcrack, which only needs 624 numbers:

```python
rc = randcrack.RandCrack()

counter = 0
for num in v_32:
    if counter == 624:
        break
    counter += 1
    rc.submit(num)
```



Here's the revised text in Markdown format:

markdown
Copy code
## Decrypting AES Encrypted Message in the Challenge

To decrypt a message encrypted with AES (Advanced Encryption Standard), you need to know the key and the Initialization Vector (IV). The challenge provides the IV in the code, so the goal is to determine the key used.

The key is generated using Python's random library. Initially, it generates 99 numbers of 256 bits, and the 100th value is the key used.

After some research, it was found that the random library in Python uses a pseudo-random number generator (PRNG) to generate numbers, which are not truly random. The library takes a seed and uses it to generate numbers.

To find the key, we can use a tool or method to predict the state or seed used by the PRNG. One such tool is randcrack, which can take 624 32-bit numbers to find the state and predict the next numbers.

The challenge is that we only have 99 numbers of 256 bits, but we need 624 32-bit numbers. To address this, we convert each 256-bit number into 8 32-bit numbers using a simple calculation:

```python
v_32 = []
for num in range(len(values)):
    for j in range(256 // 32):
        v_32.append((values[num] >> (j * 32)) & 0xFFFFFFFF)
```
Once we have 800 32-bit numbers from the 99 256-bit numbers, we can feed them to randcrack, which only needs 624 numbers:

```python
rc = randcrack.RandCrack()

counter = 0
for num in v_32:
    if counter == 624:
        break
    counter += 1
    rc.submit(num)
Then, we can print the next values to validate the predictions:
```
``` python
for i in range(624, 800, 1):
    print(i, rc.predict_getrandbits(32), v_32[i])
After that, we can predict the key, which is the next 256-bit value, and decrypt the flag:
```
``` python

key = rc.predict_getrandbits(256).to_bytes(32, 'little')
print("key is: ", key)
iv = b"alpha_gift_for_u"
dec_flag = 407233892575130114622365471152848476992260719477162766601742037494600998779015057202013660718343213377246033388142835468677928608741241395870321712036437

cipher = AES.new(key, AES.MODE_CBC, iv)
flag = cipher.decrypt(pad(long_to_bytes(dec_flag), AES.block_size))
print(f'flag={flag}')
```

# the final code
``` python
import randcrack
import random

from Crypto.Util.number import long_to_bytes
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad
values=[
73185524267088008429462290964819324153206788910125009334195712310294945767838,
14600252436969985620648715118422761878430765395582651030528838345822812921502,
79125432868459949704419938891039052130208668038457905463784079051316259169562,
73518890821018006009533398679054244921669865353167329276907392924995414839747,
13582977223449607373117897759438671213933184084533172799602270503617107805116,
19272179211942404176552278028232361740951580860854277295812981063394550528790,
36303951607210406310207839848244484037943626402918147577826583204708856563176,
106461827773729950683002125682159938446757475962047273907465803945522639721329,
98416550289369853842212652106816433596965195094499882265230184477598880016402,
75018162457169850372194917920767827222251770684826710208559444726781104557014,
56693947329879990081358353456072295684517161947397232179731410147138574235524,
61176889330224788628917159682802004677041846767744332267751075218313621475324,
103279251935303280426138940539474038104024556979633413114442358720152687212870,
94163885117543166445680831121764024432349621758468464769831441152367763185166,
96833398094253073895167057935728753067269905407308700785560922482306385683593,
76713273682407984322337703457301225971051994020079843651353750094871162606234,
37500803302167340556342256033292295807972530314295115149401631586462250742389,
108106824515549926876551491027886661687948747155117717272123345033048807584701,
21833932897059737337444198412601984081576001025556451510421904426452305702108,
6479012341971319281691314125876655414499726599188306715985047134078995102659,
83189312581118914561711388514425723645832703768834507947402364613784217598267,
6240700906984196748536047924985541436297210853037621363119199380962724245692,
67136904491165975844980410154400545602194927428116900238468130109994781725835,
58034645709363924524245159577579689838582768505169408740509274452913219434588,
89266170477312291474524179769533097872228241446956178584012930231201859651162,
19739836058484076319315731807728562579920665216370411806655154377177678936205,
47568869201972507087793610484819922357978900648338527120968177720536402684702,
84228266291701794694933996500965209490693796813708920004502470408581604541004,
67985905422306416877094300556714524871150789973440728469134753855820432124841,
21332715795112361186570951359052126846527660904718689657045403560488834680266,
21857849475677772786705945746329291254388690637752782992974076947437481832850,
98206251344365963208437119262550807373686414490492093253341874044814122952836,
9164896416553203931005194537370755778909625529797974154071334968502276158059,
99113787996807414594817214351617701972000772236723640386218596480364626188733,
75905207467546753203244678012765205428305511970491660339742740598066471624633,
70039344829279774536738253267594828943568391463314829653809635612514102831941,
53116433894774414922194254596864619500354561323660988072087875258143803616618,
20544539589066143122327607848450152290671860976439438461012615354092190828219,
106929251450764140725516860476041123607635480926940065050218964709273801066452,
21781369800865692427395938225643920483532888975378041396089517104916608768966,
100264332471986528479697187776808082761274751545387442221498206866244473731929,
87257414479157690143771338008174216517603840213085081280754409990382782950468,
10981217312509427716480479058860206344458013580197964405822956123087305982759,
23945539316791885325159498131441736460206396606022335037862295471690455618154,
26107285448622977129010556285416079013562982753545806634564304829309820080129,
107155287866067036531510967788615547558601122077217691814343255225499920614744,
1673001046942870958173891565644649120923450588098849735671768775964181944491,
3838287623894559848935904974290655405774106645848560393778563233650244004723,
35108062917844011311302478008122791239880545906264926631276157469765140896097,
39793139546135753947069604894807397891138866540659103714889175889927961177835,
50784013393059664479737943543785636172689713418325054022848983535221201904122,
19548386515702209741164156734952004473703483197529948368893624004150482490173,
76284080893240113246409366540319170193628227776401795032447684613716153907781,
3724208951718804913918402116515875728173588707446009890002499559362485704591,
90072887025731486424854928766582797479956914090587281528585445779053963944315,
99808532877629220838117070813375935286224514488182155443030197357401009109114,
25325176503119213903004233504062293438747799666133137227793388886527120283189,
34739450358125519551692656064691265837030710460679888682543569230476102260579,
112221227436826923153797161145163423805132892373808772963827057610085550737047,
115640931046893614916710868892525861018216262088586035107147275448097317151919,
58155408477833613147745791058283314863978626070781092328865280134105207111295,
89610294088114264442809481064330967516384137668928594746141520320820542359368,
96932145349966715648937044404838567104445251198247759271701600078527316982676,
81995143559246441212516484625629988125577886852927619203286462650358858799397,
115041111574784835891652688982461297000400562972113742927470892692363135886623,
7599305500188439375362333160172589310098185473500515896557150187774079786705,
48380042571121228581185223912421453392608298668070741398676413253866586326896,
26078827323628609551410948515222055268205511596146459689055681848435139680533,
34072045684145551494052002921902327736210587251851260915461253184378512262160,
13979089224390676226770258067320499035176641745137300835597961713791676162340,
112120403756409144627842527824437919156357924219977968509019143037383541211563,
40527671330510092900303898404900382268383480039948566011744736851338339730787,
68086287909288353005303370966126984761852342867815529060906473175955544903733,
99268180647587825138436362981620434014070011826429413793388542981532853408782,
42431047732262151872280294277900546493923011659230206263266756095167442899344,
4046310464412161280191075991463848424190607843588619710852578077586792576693,
61301807711153066042276626854900792410662921852607529546237208862455909974593,
76515028107581083602663121562154816163301630596342546272423459259684257041160,
77214952148748701486758167909113353470547806369376787843374134818354582816399,
2203341810940477019425059870611675097277471659196264305290992330605407986760,
18690037558524392133594951525790947622581276736336250402576469159009674296391,
95150016003362930896145758170650303612177476012859287874459343580353176737869,
104466021485553787245977297973737888826566108959357100512309562639608186064890,
4994033645625724833574323789089898978857616134883027361126812060983863702633,
71951846700572363170322927019513954474272153178630687336868851084920692496759,
114823891939582969640546089359485318734591269407783645111742510680900582434371,
51959513450587618494346249828263284460846724811902312654629820169128271457070,
101412627003610916054607921298038951701957949129912292851993591863334479734683,
107386417759496574079859970306529550538677168029469149340778707191670568916260,
35960957256488878628290304450339062557019805260455952545860414026754912832155,
102902983983788854619119959194874653259600231957971461804091553512512042474948,
86289006381153087888272398119781893738692853829258651431737579866835205842790,
40988449957961090183494242808448017005178478468948746131745979445076489334058,
105761649655611324465942209800878163772269949448572469697815790766450843664061,
54459049884207576228904195313762471400505886074153450729258750597734664855085,
65795733170815522874071409003998533146068077478359832130136827487817818503932,
99297807173073487160347512318373925576313770865052331659139894818340972000220,
34464266184850493933788559889049213669799233501640297282269118406454720972575,
42017608290774937833311545189298492078547487657441777576851352915700675077829,
5910709507806193119961565988351234600396265138267629566942033744651621109361]

v_32=[]
# Extract 32-bit numbers
for  num in range(len(values)):
    
  for j in range(256 //32):
    v_32.append ((values[num] >> (j * 32)) & 0xFFFFFFFF)
print(len(v_32))


rc =randcrack.RandCrack()

counter=0
for  num in v_32 :
  if counter == 624:
    break
  counter +=1
  rc.submit(num)

for i in range(624 , 800,1):
  print(i , rc.predict_getrandbits(32) ,v_32[i] )  

key = rc.predict_getrandbits(256).to_bytes(32, 'little')
print("key is: " ,key)
iv = b"alpha_gift_for_u"
dec_flag=407233892575130114622365471152848476992260719477162766601742037494600998779015057202013660718343213377246033388142835468677928608741241395870321712036437

cipher = AES.new(key, AES.MODE_CBC, iv)
flag = cipher.decrypt(pad(long_to_bytes(dec_flag),AES.block_size))
print(f'flag={flag}')
```

Conclusion
By understanding the underlying principles of AES encryption and the random library in Python, we can successfully decrypt the flag in the challenge.
